#include "IO_control.h"

infoMal infoMal_teacher = {0,0,0,0,0};
infoMal infoMal_student = {0,0,0,0,0};

uchar resIOJudge[9] = {0};

void IOInit(void){

 	DDRA  = DDRB  = DDRC  = DDRD  = DDRE  = DDRF  = 0xff;
	PORTA = PORTB = PORTC = PORTD = PORTE = PORTF = 0;
}

void IOReinstate(void){

	infoMal_teacher.dianfengshan =\
	infoMal_teacher.weibolu =\
	infoMal_teacher.dianfanbao =\
	infoMal_teacher.xiyiji =\
	infoMal_teacher.xiaodugui \
	= 0;
	
	infoMal_student.dianfengshan =\
	infoMal_student.weibolu =\
	infoMal_student.dianfanbao =\
	infoMal_student.xiyiji =\
	infoMal_student.xiaodugui \
	= 0;
	
	IOInit();
}

void OPJudje(uchar T,uchar S,uchar Base){ 		  //直接异或比较输出结果

	uchar temp,loop,pt;
	pt = 0;
	
	temp = T ^ S;
	for(loop = 0;loop < 8;loop ++){
			 
		if((temp >> loop) & 0x01)resIOJudge[pt++] = Base + loop;
	}
	
	//resIOJudge[6] = temp;						  		 //测试比较结果输出
	//resIOJudge[7] = infoMal_teacher.xiaodugui;
	//resIOJudge[8] = infoMal_student.xiaodugui;
}

//单字节从右到左分别表示设故编号
//1-4号电风扇、5-6号微波炉、7-9号电饭煲、10-12号洗衣机、13-14号消毒柜
void dianfengshan_IO(uchar obj,uchar a){	   //1-4号电风扇

	if(obj == 'T')infoMal_teacher.dianfengshan |= (1 << (a-1)); //教师端设故信息更新
	if(obj == 'S')infoMal_student.dianfengshan |= (1 << (a-1));	//学生端设故信息更新
	//IO Opreation here
}

void dianfanbao_IO(uchar obj,uchar a){	  	   //5-7号电饭煲

	if(obj == 'T')infoMal_teacher.dianfanbao |= (1 << (a-1)); 	//教师端设故信息更新
	if(obj == 'S')infoMal_student.dianfanbao |= (1 << (a-1));	//学生端设故信息更新
	//IO Opreation here
}

void weibolu_IO(uchar obj,uchar a){			   //8-9号微波炉

	if(obj == 'T')infoMal_teacher.weibolu |= (1 << (a-1)); 	//教师端设故信息更新
	if(obj == 'S')infoMal_student.weibolu |= (1 << (a-1));	//学生端设故信息更新
	//IO Opreation here
}

void xiaodugui_IO(uchar obj,uchar a){	 	   //10-11号消毒柜

	if(obj == 'T')infoMal_teacher.xiaodugui |= (1 << (a-1)); 	//教师端设故信息更新
	if(obj == 'S')infoMal_student.xiaodugui |= (1 << (a-1));	//学生端设故信息更新
	//IO Opreation here
}

void xiyiji_IO(uchar obj,uchar a){			   //12-14号洗衣机

	if(obj == 'T')infoMal_teacher.xiyiji |= (1 << (a-1)); 	//教师端设故信息更新
	if(obj == 'S')infoMal_student.xiyiji |= (1 << (a-1));	//学生端设故信息更新
	//IO Opreation here
}